<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Колесо откачек</title>
	<link rel="icon" href="images/avatarochka.png" type="image/png" />
    <style type="text/css">
body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    font-family: 'Moderustic', sans-serif;
    background-image: url('images/background2.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 1) 80%);
    z-index: -1;
}

@font-face {
    font-family: 'Moderustic';
    src: url('fonts/Neucha.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'Neucha';
    src: url('fonts/Moderustic.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

@media (max-width: 768px) {
    #chart {
        width: 300px;
        height: 300px;
    }
    .spin-button {
        padding: 10px 20px;
        font-size: 18px;
    }
}

#winner {
    font-size: 36px;
    font-family: 'Moderustic', sans-serif;
    color: white;
    margin-bottom: 20px;
    opacity: 0;
    transition: opacity 1s ease;
    margin-left: -30px;
}

#chart {
    position: relative;
    width: 700px;
    height: 700px;
}

.arrow {
    position: absolute;
    top: calc(50% - 33px);
    left: calc(100% - 60px);
    font-size: 55px;
    animation: pointer-pulse 3s infinite;
    font-weight: bold;
    color: #FFD700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 1);
}

.center-gif {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200px;
    height: 200px;
    transform: translate(-50%, -50%) translateX(-15px);
    border-radius: 50%;
    pointer-events: none;
    border: 3px solid black;
}

@keyframes pointer-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.spin-button {
    margin-top: 30px;
    padding: 20px 50px;
    font-size: 28px;
    font-weight: bold;
    font-family: 'Moderustic', sans-serif;
    text-transform: uppercase;
    letter-spacing: 2px;
    background: linear-gradient(45deg, #ffcc00, #ff6600, #ffcc00);
    color: #fff;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 220px;
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.7), inset 0 0 10px rgba(255, 140, 0, 0.5);
    position: relative;
    overflow: hidden;
    margin-left: -30px;
    transform: perspective(500px) rotateX(10deg);
}

.spin-button:hover {
    background: linear-gradient(45deg, #ffdb4d, #ff3300, #ffdb4d);
    box-shadow: 0 8px 25px rgba(255, 215, 0, 1), inset 0 0 15px rgba(255, 140, 0, 0.8);
    transform: perspective(500px) rotateX(10deg) scale(1.05);
}

.spin-button:active {
    background: linear-gradient(45deg, #ff9900, #cc3300, #ff9900);
    box-shadow: 0 4px 10px rgba(255, 140, 0, 1), inset 0 0 15px rgba(255, 69, 0, 0.9);
    transform: perspective(500px) rotateX(10deg) scale(0.98);
}

.title-container {
    position: absolute;
    top: 20px;
    left: 20px;
    text-align: center;
}

.combined-title {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 20px;
    background: linear-gradient(180deg, #333, #111);
    border: 3px solid gold;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.casino-title {
    font-family: 'Moderustic', sans-serif;
    font-size: 40px;
    color: #FFD700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3), 0 0 20px rgba(255, 215, 0, 0.8);
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: bold;
}

.promo-text {
    font-family: 'Moderustic', sans-serif;
    font-size: 20px;
    color: #FFD700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3), 0 0 20px rgba(255, 215, 0, 0.8);
    letter-spacing: 1px;
    font-weight: bold;
    margin-top: 5px;
}

.slice text {
    font-family: 'Moderustic', sans-serif;
    fill: black;
    stroke: white;
    stroke-width: 1.5px;
}

.slice path {
    stroke: black;
    stroke-width: 2px;
}

.slice:nth-child(odd) text {
    fill: black;
    stroke: white;
    stroke-width: 1.5px;
}

.slice:nth-child(even) text {
    fill: white;
    stroke: black;
    stroke-width: 1.5px;
}

.switch-wheel-button {
    top: 25px;
    right: -20px;
    padding: 10px 20px;
    font-size: 18px;
    font-weight: bold;
    font-family: 'Moderustic', sans-serif;
    text-transform: uppercase;
    letter-spacing: 2px;
    background: linear-gradient(45deg, #ffcc00, #ff6600, #ffcc00);
    color: #fff;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 220px;
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.7), inset 0 0 10px rgba(255, 140, 0, 0.5);
    position: relative;
    overflow: hidden;
    margin-left: -30px;
    transform: perspective(500px) rotateX(10deg);
}

.switch-wheel-button:hover {
    background: linear-gradient(45deg, #ffdb4d, #ff3300, #ffdb4d);
    box-shadow: 0 8px 25px rgba(255, 215, 0, 1), inset 0 0 15px rgba(255, 140, 0, 0.8);
    transform: perspective(500px) rotateX(10deg) scale(1.05);
}
</style>
</head>
<body>
<div class="title-container">
    <div class="combined-title">
        <span class="casino-title">SHINNEE WHEEL</span>
        <span class="promo-text">ШАНС ОКУПИТЬСЯ БОЛЬШЕ ЧЕМ НЕ ОКУПИТЬСЯ!</span>
    </div>
    <button class="switch-wheel-button" id="switchWheelButton">Переключить колесо</button>
</div>

<div id="winner">Победитель получил: <span id="prize">-</span></div>
<div style="position: relative; display: inline-block;">
    <div id="chart"></div>
    <img src="images/pj pocheshi.gif" class="center-gif" alt="GIF">
    <div class="arrow">&#9664;</div>
</div>
<button class="spin-button" id="spinButton">Прокрутить</button>

<audio id="spinSound1" src="voice/pj dai 2k.ogg"></audio>
<audio id="spinSound2" src="voice/podkrutka.mp3"></audio>
<audio id="spinSound3" src="voice/veseluha prodolzhaetsa.mp3"></audio>
<audio id="spinSound4" src="voice/zabanil.ogg"></audio>
<audio id="spinSound5" src="voice/poshel.mp3"></audio>
<audio id="spinSound6" src="voice/razbanivai.ogg"></audio>
<audio id="spinSound7" src="voice/gla gla.ogg"></audio>
<audio id="spinSound8" src="voice/zabany.mp3"></audio>
<audio id="spinSound9" src="voice/omletik.mp3"></audio>
<audio id="spinSound10" src="voice/okak.mp3"></audio>
<audio id="spinSound11" src="voice/shinnee.ogg"></audio>
<audio id="spinSound12" src="voice/neytik.ogg"></audio>

<script src="https://d3js.org/d3.v3.min.js"></script>

<script type="text/javascript">

    var padding = {top:20, right:40, bottom:0, left:0},
        w = 700 - padding.left - padding.right,
        h = 700 - padding.top  - padding.bottom,
        r = Math.min(w, h)/2,
        rotation = 0,
        oldrotation = 0,
        picked = 100000,
        oldpick = [],
        color = d3.scale.category20();

    // Данные для первого колеса (деньги)
    var moneyWheelData = [
        {"label": "1500 + додеп 1000", "weight": 80},  
        {"label": "2000", "weight": 30},  
        {"label": "3000", "weight": 10},  
        {"label": "1000 + доп. спин", "weight": 15},  
        {"label": "5000", "weight": 1},  
        {"label": "2000", "weight": 30},  
        {"label": "1500 + додеп 1000", "weight": 80},  
        {"label": "3000", "weight": 10},  
        {"label": "1500 + додеп 1000", "weight": 80},  
        {"label": "x2", "weight": 1},  
        {"label": "2000", "weight": 30},  
        {"label": "3000", "weight": 10},  
        {"label": "1500 + додеп 1000", "weight": 80},  
        {"label": "2000", "weight": 30},  
        {"label": "1500 + додеп 1000", "weight": 80},  
        {"label": "2000", "weight": 30},  
        {"label": "3000", "weight": 10},  
        {"label": "1000 + доп. спин", "weight": 15},  
        {"label": "2000", "weight": 30},  
        {"label": "1500 + додеп 1000", "weight": 80},  
        {"label": "3000", "weight": 10},  
        {"label": "2000", "weight": 30}  
    ];

    // Данные для второго колеса (дропы)
    var dropWheelData = [
        {"label": "Скинбрат", "weight": 30},
        {"label": "Кспадение", "weight": 20},
        {"label": "Какабатл", "weight": 20},
        {"label": "Дилдодроп", "weight": 15},
        {"label": "Забуллилдроп", "weight": 15},
        {"label": "Скинбрат", "weight": 30},
        {"label": "Кспадение", "weight": 20},
        {"label": "Какабатл", "weight": 20},
        {"label": "Дилдодроп", "weight": 15},
        {"label": "Забуллилдроп", "weight": 15},
        {"label": "Скинбрат", "weight": 30},
        {"label": "Кспадение", "weight": 20}
    ];

    var currentWheelData = moneyWheelData;
    var isMoneyWheel = true;

    var svg = d3.select('#chart')
        .append("svg")
        .attr("width", w + padding.left + padding.right + 100)
        .attr("height", h + padding.top + padding.bottom + 100)
        .style("overflow", "visible");
        svg.style("pointer-events", "none");

    var container = svg.append("g")
        .attr("class", "chartholder")
        .attr("transform", "translate(" + (w/2 + padding.left) + "," + (h/2 + padding.top) + ")");

    var vis = container.append("g");

    var pie = d3.layout.pie().sort(null).value(() => 1);
    var arc = d3.svg.arc().outerRadius(r);
    var defs = svg.append("defs");

    var filter = defs.append("filter")
        .attr("id", "glow");
    
    filter.append("feGaussianBlur")
        .attr("stdDeviation", "3.5")
        .attr("result", "coloredBlur");

    var feMerge = filter.append("feMerge");
    feMerge.append("feMergeNode")
        .attr("in", "coloredBlur");
    feMerge.append("feMergeNode")
        .attr("in", "SourceGraphic");

    container.append("circle")
    .attr("r", r)
    .attr("fill", "none")
    .attr("stroke", "gold")
    .attr("stroke-width", 8)
    .attr("filter", "url(#glow)");

    function drawWheel() {
        // Очищаем старое колесо
        vis.selectAll(".slice").remove();

        var arcs = vis.selectAll("g.slice")
            .data(pie(currentWheelData))
            .enter()
            .append("g")
            .attr("class", "slice");

        arcs.append("path")
            .attr("fill", (d, i) => (i % 2 === 0) ? "#8B0000" : "#FFFFFF")
            .attr("d", arc)
            .attr("stroke", "black")
            .attr("stroke-width", 2);

        arcs.append("text")
            .attr("transform", function(d){
                d.innerRadius = 0;
                d.outerRadius = r;
                d.angle = (d.startAngle + d.endAngle)/2;
                return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")translate(" + (d.outerRadius -10) +")";
            })
            .attr("text-anchor", "end")
            .attr("font-size", "20px")
            .text((d, i) => currentWheelData[i].label);
    }


    // Инициализация первого колеса
    drawWheel();

    document.getElementById("spinButton").addEventListener("click", spin);

    document.getElementById("switchWheelButton").addEventListener("click", function() {
        isMoneyWheel = !isMoneyWheel;
        currentWheelData = isMoneyWheel ? moneyWheelData : dropWheelData;
        
        // Обновляем заголовок
        document.querySelector(".casino-title").textContent = isMoneyWheel ? "SHINNEE WHEEL" : "САЙТОВЫЙ WHEEL";
        document.querySelector(".promo-text").textContent = isMoneyWheel ? 
            "ШАНС ОКУПИТЬСЯ БОЛЬШЕ ЧЕМ НЕ ОКУПИТЬСЯ!" : 
            "КРУТИ И УЗНАЙ НА КАКОМ САЙТЕ МЫ ТЕБЯ ОТКАЧАЕМ!";
        
        // Перерисовываем колесо
        drawWheel();
        
        // Сбрасываем отображение победителя
        document.getElementById("winner").style.opacity = 0;
        document.getElementById("prize").textContent = "-";
    });

    var forceNextSpin = false;
    var spinCount = 0;

    function spin() {
        var ps = 360 / currentWheelData.length,
            rng = Math.floor((Math.random() * 1440) + 360);

        rotation = (Math.round(rng / ps) * ps);
        picked = Math.round(currentWheelData.length - (rotation % 360) / ps);
        picked = picked >= currentWheelData.length ? (picked % currentWheelData.length) : picked;

        spinCount++;

        if (isMoneyWheel) {
            if (spinCount < 10) {
                while (currentWheelData[picked].label === "1000 + доп. спин") {
                    rng = Math.floor((Math.random() * 1440) + 360);
                    rotation = (Math.round(rng / ps) * ps);
                    picked = Math.round(currentWheelData.length - (rotation % 360) / ps);
                    picked = picked >= currentWheelData.length ? (picked % currentWheelData.length) : picked;
                }
            } else {
                spinCount = 0;
            }

            while (currentWheelData[picked].label === "x2" || currentWheelData[picked].label === "5000") {
                rng = Math.floor((Math.random() * 1440) + 360);
                rotation = (Math.round(rng / ps) * ps);
                picked = Math.round(currentWheelData.length - (rotation % 360) / ps);
                picked = picked >= currentWheelData.length ? (picked % currentWheelData.length) : picked;
            }
        }

        rotation += 90 - Math.round(ps / 2);

        var winnerElement = document.getElementById("winner");
        winnerElement.style.opacity = 0;

        var sounds = [
            document.getElementById("spinSound1"),
            document.getElementById("spinSound2"),
            document.getElementById("spinSound3"),
            document.getElementById("spinSound4"),
            document.getElementById("spinSound5"),
            document.getElementById("spinSound6"),
            document.getElementById("spinSound7"),
            document.getElementById("spinSound8"),
            document.getElementById("spinSound9"),
            document.getElementById("spinSound10"),
            document.getElementById("spinSound11"),
            document.getElementById("spinSound12")
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        var shuffledSounds = shuffleArray([...sounds]);
        var currentIndex = 0;

        function getNextSound() {
            if (currentIndex >= shuffledSounds.length) {
                shuffledSounds = shuffleArray([...sounds]);
                currentIndex = 0;
            }

            var nextSound = shuffledSounds[currentIndex];
            currentIndex++;
            return nextSound;
        }

        var spinSound = getNextSound();
        spinSound.volume = 0.2; // Устанавливаем громкость 20%
		spinSound.play();

        vis.transition()
            .duration(5000)
            .attrTween("transform", rotTween)
            .each("end", function () {
                oldrotation = rotation;
                document.getElementById("prize").innerText = currentWheelData[picked].label;
                winnerElement.style.opacity = 1;
            });
    }

    function rotTween() {
        var i = d3.interpolate(oldrotation % 360, rotation);
        return function (t) {
            return "rotate(" + i(t) + ")";
        };
    }

</script>
</body>
</html>